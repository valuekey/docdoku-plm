<div layout-fill layout="column">
    <md-toolbar md-scroll-shrink>
        <div class="md-toolbar-tools" layout="row" layout-align="space-between center">
            <h2>
                <span>
                    <i class="fa fa-folder-open"></i>
                    <i class="fa fa-star favorite" ng-if="folder.favorite"></i>
                    {{ folder.path | fileshortname }} ({{totalFilesInFolder}} {{'FILES'|translate}})
                </span>
            </h2>
        </div>

    </md-toolbar>

    <md-content>

        <div layout="row" layout-align="space-between start">
            <md-menu-bar>
                <md-menu>
                    <button ng-click="$mdOpenMenu()">
                        {{'FILE' | translate}}
                    </button>

                    <md-menu-content>
                        <md-menu-item>
                            <md-button aria-label="{{'REFRESH_FOLDER'|translate}}" ng-click="fetchFolder()">
                                <md-icon md-svg-icon="img/cached.svg"></md-icon>
                                {{'REFRESH_FOLDER'|translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button ng-click="reveal()">
                                <md-icon md-svg-icon="img/folder-open.svg"></md-icon>
                                {{'OPEN_IN_EXPLORER' | translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button aria-label="{{'FAVORITE'|translate}}" ng-click="toggleFavorite()">
                                <md-icon md-svg-icon="img/star-border.svg"></md-icon>
                                {{'FAVORITE'|translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button aria-label="{{'DELETE_FOLDER'|translate}}" ng-click="delete($event)">
                                <md-icon md-svg-icon="img/delete.svg"></md-icon>
                                {{'DELETE_FOLDER'|translate}}
                            </md-button>
                        </md-menu-item>
                    </md-menu-content>
                </md-menu>

                <md-menu>
                    <button ng-click="$mdOpenMenu()">
                        {{'INDEX' | translate}}
                    </button>
                    <md-menu-content>
                        <md-menu-item>
                            <md-button ng-click="updateIndex()">
                                <md-icon md-svg-icon="img/index-update.svg"></md-icon>
                                {{'UPDATE_INDEX' | translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button ng-click="downloadLatest()">
                                <md-icon md-svg-icon="img/system-update.svg"></md-icon>
                                {{'DOWNLOAD_LATEST' | translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button ng-click="pushUpdates()">
                                <md-icon md-svg-icon="img/put.svg"></md-icon>
                                {{'PUSH_UPDATES' | translate}}
                            </md-button>
                        </md-menu-item>
                    </md-menu-content>
                </md-menu>

                <md-menu>
                    <button ng-click="$mdOpenMenu()">
                        {{'FILTERS' | translate}}
                    </button>
                    <md-menu-content >

                        <md-menu-item>
                            <md-button ng-click="toggleFilters(true)">
                                <md-icon md-svg-icon="img/check.svg"></md-icon>
                                {{'SELECT_ALL' | translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button ng-click="toggleFilters(false)">
                                <md-icon md-svg-icon="img/clear.svg"></md-icon>
                                {{'UNSELECT_ALL' | translate}}
                            </md-button>
                        </md-menu-item>

                        <md-menu-divider></md-menu-divider>

                        <md-menu-item ng-repeat="filter in filters">
                            <md-input-container>
                                <md-checkbox ng-change="search()" ng-model="filter.value" aria-label="{{filter.name}}">
                                    {{filter.name}}
                                </md-checkbox>
                            </md-input-container>
                        </md-menu-item>

                    </md-menu-content>
                </md-menu>

                <md-menu>
                    <button ng-click="$mdOpenMenu()">
                        {{'SELECTION' | translate}} ({{selected.length}})
                    </button>
                    <md-menu-content>

                        <md-menu-item>
                            <md-button ng-click="checkinSelection()">
                                <md-icon md-svg-icon="img/done.svg"></md-icon>
                                {{'CHECKIN' | translate}}
                            </md-button>
                        </md-menu-item>
                        <md-menu-item>
                            <md-button ng-click="checkoutSelection()">
                                <md-icon md-svg-icon="img/edit.svg"></md-icon>
                                {{'CHECKOUT' | translate}}
                            </md-button>
                        </md-menu-item>

                    </md-menu-content>
                </md-menu>

            </md-menu-bar>

        </div>

        <div layout-padding layout="row" layout-align="space-between start">
            <md-input-container class="no-margin md-block">
                <label>{{'SEARCH'|translate}}</label>
                <input type="text" ng-change="search()" ng-model="pattern" />
            </md-input-container>
        </div>

        <div layout-padding layout="column">

            <div layout="row" layout-wrap layout-align="space-between center">

                <div ng-if="!sync.running">
                    <span class="md-caption">{{'LAST_SYNC_DATE' | translate}} {{ folder.lastSync | date:'medium'}}</span>
                </div>
                <div ng-if="sync.running">
                    <span class="md-caption">{{'SYNCING_INDEX' | translate}} {{ sync.progress }} / {{ sync.total }}</span>
                </div>

                <md-table-pagination
                        md-boundary-links="true"
                        md-limit="query.limit"
                        md-limit-options="query.limits"
                        md-page="query.page"
                        md-total="{{filteredFilesCount}}"
                        md-on-paginate="paginate"
                        md-page-select>
                </md-table-pagination>

            </div>
        </div>

        <div layout="column">

            <md-table-container>
                <table md-table md-row-select multiple ng-model="selected">
                    <thead md-head>
                        <tr md-row>
                            <th md-column><span>{{'NAME'|translate}}</span></th>
                            <th md-column><span>{{'WORKSPACE'|translate}}</span></th>
                            <th md-column><span>{{'ID'|translate}}</span></th>
                            <th md-column><span>{{'VERSION'|translate}}</span></th>
                            <th md-column><span>{{'SIZE'|translate}}</span></th>
                            <th md-column><span>{{'LAST_MODIFIED'|translate}}</span></th>
                            <th md-column><span></span></th>
                        </tr>
                    </thead>
                    <tbody md-body>
                        <tr md-row md-select="file" md-select-id="path" ng-repeat="file in displayedFiles">

                            <td md-cell>
                                <i ng-if="file.index.id"  class="fa fa-file"></i>
                                <i ng-if="file.index.number"  class="fa fa-cube"></i>
                                <i ng-if="!file.index.number && !file.index.id"  class="fa fa-question"></i>
                                <span layout-margin>{{file.path | fileshortname}}</span>
                            </td>


                            <td md-cell>{{file.index.workspace || '-' }}</td>
                            <td md-cell>{{file.index.id || file.index.number || '-' }}</td>
                            <td md-cell>{{file.index.revision}}-{{file.index.iteration}}</td>
                            <td md-cell>{{file.stat.size | humanreadablesize}}</td>

                            <td md-cell>{{(file.index.lastModifiedDate |Â date:'medium') || '-' }}</td>
                            <td md-cell>

                                <md-menu>

                                    <md-button aria-label="{{'MENU'}}" class="md-icon-button" ng-click="$mdOpenMenu($event)">
                                        <md-icon md-svg-icon="img/more_vert.svg"></md-icon>
                                    </md-button>

                                    <md-menu-content>

                                        <md-menu-item  ng-if="!file.index">
                                            <md-button aria-label="{{'CREATE_PART'|translate}}" ng-click="createPart(file)">
                                                {{'CREATE_PART'|translate}}
                                            </md-button>
                                        </md-menu-item>

                                        <md-menu-item  ng-if="!file.index">
                                            <md-button aria-label="{{'CREATE_DOCUMENT'|translate}}" ng-click="createDocument(file)">
                                                {{'CREATE_DOCUMENT'|translate}}
                                            </md-button>
                                        </md-menu-item>

                                        <md-menu-item ng-if="file.index">
                                            <md-button aria-label="{{'CHECKIN'|translate}}" ng-click="checkin(file)">
                                                {{'CHECKIN'|translate}}
                                            </md-button>
                                        </md-menu-item>

                                        <md-menu-item ng-if="file.index">
                                            <md-button aria-label="{{'CHECKOUT'|translate}}" ng-click="checkout(file)">
                                                {{'CHECKOUT'|translate}}
                                            </md-button>
                                        </md-menu-item>

                                    </md-menu-content>

                                </md-menu>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </md-table-container>
        </div>
    </md-content>
</div>